<!DOCTYPE html>
<html>

<head>
  <title>Grade Tracker</title>
  <!-- JSPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.13"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: url('Figure1.jpg') no-repeat center center fixed;
      background-size: cover;
    }

    .container {
      width: 50%;
      background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white container background color */
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Light shadow effect */
    }

    label {
      display: block;
      margin-bottom: 10px;
      color: #333; /* Dark gray label color */
    }

    select, input {
      width: 50px;
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc; /* Light gray border color */
      border-radius: 5px;
      background-color: #f9f9f9; /* Lighter gray background color */
    }

    #average {
      margin-top: 20px;
    }

    #button {
      background-color: #4caf50;
      border: none;
      border-radius: 10px;
      padding: 15px;
      color: white;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<div class="container">
  <label for="mesuesi">Mësimdhënësi:</label>
  <select id="mesuesi" name="mesuesi" style="width: 240px;">
    <option value="0"></option>
    <option value="Ilir Bytyqi">Ilir Bytyqi</option>
    <option value="Hasan Hyseni">Hasan Hyseni</option>
    <option value="Hysen Hasani">Hysen Hasani</option>
    <option value="Filon Fisteku">Filon Fisteku</option>
  </select>

  <label for="student">Nxënësi:</label> <!-- Add this label -->
  <input type="text" id="student" name="student" style="width: 220px;"> <!-- Add this input field -->

<body>
  <div class="container">
    <label for="math">Matematikë:</label>
    <select id="math" name="math" onchange="calculateAverage()" required>
      <option value="0"> </option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <label for="biology">Biologji:</label>
    <select id="biology" name="biology" onchange="calculateAverage()" required>
      <option value="0"> </option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <label for="physics">Fizikë:</label>
    <select id="physics" name="physics" onchange="calculateAverage()" required>
      <option value="0"> </option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <label for="informatics">Kimi:</label>
    <select id="informatics" name="informatics" onchange="calculateAverage()" required>
      <option value="0"> </option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <div id="average">
      <label for="avg">Nota Mesatare:</label>
      <input type="text" id="avg" name="avg" readonly>
    </div>

    <button id="button" onclick="generatePDF()">Printo Dëftesen në PDF</button>
  </div>

  <script>
    function calculateAverage() {
      let values = [
        parseFloat(document.getElementById("math").value) || 0,
        parseFloat(document.getElementById("biology").value) || 0,
        parseFloat(document.getElementById("physics").value) || 0,
        parseFloat(document.getElementById("informatics").value) || 0,
      ];

      // Filter out zero values
      let filteredValues = values.filter(value => value !== 0);

      // Calculate average
      let average = filteredValues.length > 0 ? filteredValues.reduce((sum, value) => sum + value, 0) / filteredValues.length : 0;

      document.getElementById("avg").value = average.toFixed(2);
    }

    function generatePDF() {
      let doc = new jsPDF();

      // Convert local image to Base64 data URI
      const imgData = getBase64Image('Shqiponja.jpg');

      const imgWidth = 70; // Adjust the width as needed
      const imgHeight = (imgWidth / doc.internal.pageSize.width) * doc.internal.pageSize.height;
      const x = (doc.internal.pageSize.width - imgWidth) / 2;
      const y = (doc.internal.pageSize.height - imgHeight) / 1.5;

      doc.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);


      // Get the selected value of "mesuesi"
      const selectedMesuesi = document.getElementById("mesuesi").value;

      // Add "Mësimdhënësi" label and its selected value to the PDF
      doc.setFont("Garamond", "normal");
      doc.setFontSize(16);
      doc.text("Mësimdhënësi: " + selectedMesuesi, 130, 270);

  

      // Get current date and time
      const currentDate = new Date();
      const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
      const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
      const formattedDate = currentDate.toLocaleDateString('en-GB', dateOptions); // European date format
      const formattedTime = currentDate.toLocaleTimeString('en-GB', timeOptions); // 24-hour format

      // Add current date and time to the PDF
      doc.text("Data: " + formattedDate + "  Ora: " + formattedTime, 20, 270);

      // Table data
      let data = [
        ["Lënda", "Nota"],
        ["Matematikë", document.getElementById("math").value],
        ["Biologji", document.getElementById("biology").value],
        ["Fizikë", document.getElementById("physics").value],
        ["Kimi", document.getElementById("informatics").value],
      ];

      // Add styled content to PDF in a table layout
      doc.setFont("helvetica", "bold");
      doc.setFontSize(30);
      doc.text("Dëftesë", 90, 20);

      // Retrieve student's name
  const studentName = document.getElementById("student").value;

// Add student's name to the PDF
doc.setFont("Garamond", "normal");
doc.setFontSize(14);
doc.text("për nxënësin: " + studentName, 83, 30);

      
      


  // Generate main table
  doc.autoTable({
    head: [data[0]],
    body: data.slice(1),
    startY: 40,
    theme: 'grid',
    styles: { fillColor: [255, 255, 255], textColor: 0, fontStyle: 'bold' },
    headStyles: { textColor: 0, fontStyle: 'bold' },
    bodyStyles: { textColor: 0 },
    alternateRowStyles: { fillColor: [255, 255, 255] }, // Alternate row color
    columnStyles: {
      0: { fontStyle: 'normal',cellWidth: 120 }, // First column (subject) normal font style
      1: { fontStyle: 'normal',cellWidth: 62 } // Second column (grade) normal font style
    },
    columnWidth: 'wrap'
  });

  // Generate table for "Nota Mesatare" outside the main table
  const notaMesatareData = [
    ["Nota Mesatare", document.getElementById("avg").value]
  ];

  doc.autoTable({
    body: notaMesatareData,
    startY: doc.autoTable.previous.finalY + 10, // Start below the main table
    theme: 'grid',
    styles: { fillColor: [230, 230, 230], textColor: [0, 0, 0], fontStyle: 'bold' },
    headStyles: { textColor: 0, fontStyle: 'bold' },
    columnStyles: {
      0: { fontStyle: 'normal',cellWidth: 120 } // First column (label) normal font style
    },
    columnWidth: 'wrap'
  });

      // Save PDF
      doc.save("Dëftesa.pdf");
    }

    function getBase64Image(imgSrc) {
      var canvas = document.createElement("canvas");
      var img = new Image();
      img.src = imgSrc;
      canvas.width = img.width;
      canvas.height = img.height;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);
      var dataURL = canvas.toDataURL("image/jpeg");
      return dataURL;
    }

  </script>
</body>

</html>
